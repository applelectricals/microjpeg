import{r as b,j as v}from"./index-BmEBa6jd.js";function j({amount:p,currency:d,intent:l,planId:o}){const y=async()=>({orderId:(await(await fetch("/paypal/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:p,currency:d,intent:l})})).json()).id}),m=async t=>await(await fetch(`/paypal/order/${t}/capture`,{method:"POST",headers:{"Content-Type":"application/json"}})).json(),w=async t=>{const e=await m(t.orderId);if(e.status==="COMPLETED")try{if((await fetch("/api/activate-paypal-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:t.orderId,paymentId:e.id,amount:p,plan:o==="test-premium"?"test_premium":o==="enterprise"?"enterprise":"premium"})})).ok){const n=o==="test-premium"?"test-premium":o==="enterprise"?"enterprise":"premium",s=o==="test-premium"?"1":o==="enterprise"?"99":"29";window.location.href=`/subscription-success?plan=${n}&amount=${s}&paypal_payment_id=`+e.id}else alert("Payment successful but subscription activation failed. Please contact support.")}catch(a){console.error("Subscription activation error:",a),alert("Payment successful but subscription activation failed. Please contact support.")}},P=async t=>{},f=async t=>{};b.useEffect(()=>{(async()=>{try{if(window.paypal)await i();else{const n=(await(await fetch("/paypal/setup")).json()).isLiveMode||!1,s=document.createElement("script");s.src=n?"https://www.paypal.com/web-sdk/v6/core":"https://www.sandbox.paypal.com/web-sdk/v6/core",s.async=!0,s.onload=()=>i(),document.body.appendChild(s)}}catch(e){console.error("Failed to load PayPal SDK",e)}})()},[]);const i=async()=>{try{const e=await(await fetch("/paypal/setup")).json(),a=e.clientToken,n=e.isLiveMode||!1,h=(await window.paypal.createInstance({clientToken:a,components:["paypal-payments"]})).createPayPalOneTimePaymentSession({onApprove:w,onCancel:P,onError:f}),u=async()=>{try{const c=y();await h.start({paymentFlow:"auto"},c)}catch(c){console.error(c)}},r=document.getElementById("paypal-button");return r&&r.addEventListener("click",u),()=>{r&&r.removeEventListener("click",u)}}catch(t){console.error(t)}};return v.jsx("paypal-button",{id:"paypal-button"})}export{j as default};
