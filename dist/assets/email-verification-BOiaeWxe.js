import{h as E,r as d,f as b,i as k,l as P,j as e,k as f}from"./index-BmEBa6jd.js";import{u as p}from"./useMutation-DR4V7Yvb.js";import{B as u}from"./button-COO6ib03.js";import{C as j,a as V,b as S,c as F,d as y}from"./card-BgNaLGW4.js";import{A as n,a as l}from"./alert-Cwr1IrGR.js";import{L as g}from"./loader-circle-DpNKEe5d.js";import{C as v}from"./circle-check-big-D_tWOXDK.js";import{C as N}from"./circle-x-BVM2inm6.js";import{M as c}from"./mail-Jla-S5RN.js";import{C as T}from"./clock-avNKhVX2.js";function Q(){var x;const[,o]=E(),[r,w]=d.useState(null),{toast:t}=b(),C=k();d.useEffect(()=>{const h=new URLSearchParams(window.location.search).get("token");w(h)},[]);const s=p({mutationFn:async i=>await(await f("GET",`/api/auth/verify-email/${i}`,null)).json(),onSuccess:i=>{C.invalidateQueries({queryKey:["/api/auth/user"]}),t({title:"Email Verified!",description:"Your email has been successfully verified. Welcome to JPEG Compressor!"}),setTimeout(()=>o("/"),2e3)},onError:i=>{t({title:"Verification Failed",description:i.message||"Failed to verify email. Please try again.",variant:"destructive"})}}),m=p({mutationFn:async()=>await(await f("POST","/api/auth/resend-verification",{})).json(),onSuccess:()=>{t({title:"Email Sent",description:"A new verification email has been sent to your inbox."})},onError:i=>{t({title:"Failed to Send Email",description:i.message||"Could not send verification email. Please try again.",variant:"destructive"})}});d.useEffect(()=>{r&&!s.isPending&&s.mutate(r)},[r]);const{data:a}=P({queryKey:["/api/auth/user"],retry:!1});return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"JPEG Compressor"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Email Verification"})]}),e.jsxs(j,{children:[e.jsxs(V,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[s.isPending?e.jsx(g,{className:"w-5 h-5 animate-spin text-blue-600"}):s.isSuccess?e.jsx(v,{className:"w-5 h-5 text-green-600"}):s.isError?e.jsx(N,{className:"w-5 h-5 text-red-600"}):e.jsx(c,{className:"w-5 h-5 text-blue-600"}),"Email Verification"]}),e.jsx(F,{children:s.isPending?"Verifying your email address...":s.isSuccess?"Verification successful!":s.isError?"Verification failed":"Verify your email to continue"})]}),e.jsxs(y,{className:"space-y-4",children:[s.isPending&&e.jsxs(n,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(l,{children:"Please wait while we verify your email address..."})]}),s.isSuccess&&e.jsxs(n,{className:"border-green-200 bg-green-50",children:[e.jsx(v,{className:"h-4 w-4 text-green-600"}),e.jsx(l,{className:"text-green-700",children:"Your email has been successfully verified! You'll be redirected to the home page shortly."})]}),s.isError&&e.jsxs(n,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(l,{children:((x=s.error)==null?void 0:x.message)||"Verification failed. The link may be expired or invalid."})]}),!r&&e.jsxs(n,{children:[e.jsx(c,{className:"h-4 w-4"}),e.jsx(l,{children:"No verification token found. Please check your email for the verification link."})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[s.isSuccess&&e.jsx(u,{onClick:()=>o("/"),className:"w-full",children:"Continue to Home"}),s.isError&&a&&a.isEmailVerified!=="true"&&e.jsx(u,{onClick:()=>m.mutate(),disabled:m.isPending,variant:"outline",className:"w-full",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Resend Verification Email"]})}),e.jsx(u,{onClick:()=>o("/"),variant:"outline",className:"w-full",children:"Back to Home"})]})]})]}),a&&a.isEmailVerified!=="true"&&e.jsx(j,{className:"bg-blue-50 border-blue-200",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Check Your Email"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["We've sent a verification link to ",e.jsx("strong",{children:a.email}),". Click the link in the email to verify your account."]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Didn't receive the email? Check your spam folder or resend the verification email."})]})]})})})]})})}export{Q as default};
