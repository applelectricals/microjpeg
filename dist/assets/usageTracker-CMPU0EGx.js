const g="micro-jpeg-daily-usage";function l(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")}`}function m(){return new Date().toISOString().split("T")[0]}function h(e){const t=m();return e.date!==t}function a(){try{const e=sessionStorage.getItem(g);if(!e)return c();const t=JSON.parse(e);return t.hourlyData||(t.hourlyData=[]),h(t)?c():t}catch(e){return console.warn("Failed to read usage from sessionStorage:",e),c()}}function c(){const e={date:m(),compressions:0,conversions:0,lastReset:Date.now(),hourlyData:[]};return u(e),e}function u(e){try{sessionStorage.setItem(g,JSON.stringify(e))}catch(t){console.warn("Failed to save usage to sessionStorage:",t)}}function f(e){const t=l();e.hourlyData||(e.hourlyData=[]);const r=e.hourlyData.find(o=>o.hour===t);return r?r.operations:0}function d(e,t=1){const r=l();e.hourlyData||(e.hourlyData=[]);const o=e.hourlyData.find(i=>i.hour===r);o?o.operations+=t:e.hourlyData.push({hour:r,operations:t});const n=new Date;n.setHours(n.getHours()-24);const s=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}-${String(n.getHours()).padStart(2,"0")}`;e.hourlyData=e.hourlyData.filter(i=>i.hour>=s)}function p(e=1,t=5){const r=a(),o=t,n=f(r),s=Math.max(0,o-n);return n+e>o?{allowed:!1,remaining:s,message:`Hourly limit of ${o} operations reached. Try again next hour${t<=5?" or upgrade for unlimited access!":"!"}`}:{allowed:!0,remaining:s-e}}function y(e=1){const t=a(),r=25,o=Math.max(0,r-t.compressions);return t.compressions+e>r?{allowed:!1,remaining:o,message:`Daily limit of ${r} operations reached. Resets at midnight or upgrade for more!`}:{allowed:!0,remaining:o-e}}function D(e=1){const t=a(),r=3,o=Math.max(0,r-t.conversions);return t.conversions+e>r?{allowed:!1,remaining:o,message:`Daily limit of ${r} format conversions reached. Resets at midnight or upgrade for unlimited conversions!`}:{allowed:!0,remaining:o-e}}function S(e=1){const t=a();return t.compressions+=e,d(t,e),u(t),t}function I(e=1){const t=a();return t.conversions+=e,d(t,e),u(t),t}function H(){const e=a(),t=25,r=3,o=5,n=f(e),s=new Date;return s.setDate(s.getDate()+1),s.setHours(0,0,0,0),{compressions:{used:e.compressions,limit:t,remaining:Math.max(0,t-e.compressions)},conversions:{used:e.conversions,limit:r,remaining:Math.max(0,r-e.conversions)},hourly:{used:n,limit:o,remaining:Math.max(0,o-n)},resetsAt:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}function w(e,t){if(!t||t==="keep-original")return!1;const r=o=>o.toLowerCase().replace("jpg","jpeg");return r(e)!==r(t)}export{y as a,p as b,D as c,I as d,H as g,w as i,S as r};
